name: CI
on:
  push: {branches: [ main, master ]}
  pull_request: {branches: [ main, master ]}
jobs:
  build-test-lint:
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
      matrix: {python-version: [ '3.10', '3.11', '3.12' ]}
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with: {python-version: "${{ matrix.python-version }}"}
      - run: curl -LsSf https://astral.sh/uv/install.sh | sh && echo "${HOME}/.local/bin" >> $GITHUB_PATH
      - uses: actions/cache@v4
        with:
          path: |
            ~/.cache/uv
            .venv
          key: uv-${{ runner.os }}-${{ matrix.python-version }}-${{ hashFiles('pyproject.toml') }}
          restore-keys: uv-${{ runner.os }}-${{ matrix.python-version }}-
      - run: uv venv && uv pip install -e ".[dev]"
      - run: uv run ruff check .
      - run: uv run ruff format --check .
      - run: uv run mypy app tests
      - run: uv run pytest -q
